<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demon Finder Pro</title>
    <style>
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #000000; 
            color: #FFFFFF; 
        }
        .header { 
            background: linear-gradient(45deg, #00C4B4, #1E90FF); 
            color: #FFFFFF; 
            padding: 1.5rem; 
            text-align: center; 
            box-shadow: 0 2px 10px rgba(0, 192, 180, 0.5); 
        }
        .header h1 { 
            margin: 0; 
            font-size: 1.875rem; 
            font-weight: 600; 
        }
        .container { 
            max-width: 1100px; 
            margin: 1.5rem auto; 
            padding: 1.5rem; 
            background: #1A1A1A; 
            border-radius: 0.5rem; 
            box-shadow: 0 4px 15px rgba(0, 196, 180, 0.3); 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 1.5rem; 
            background-color: #2A2A2A; 
        }
        th, td { 
            border: 1px solid #333333; 
            padding: 0.75rem; 
            text-align: left; 
            color: #E0E0E0; 
        }
        th { 
            background: linear-gradient(90deg, #1E90FF, #00C4B4); 
            color: #FFFFFF; 
            font-weight: 500; 
        }
        .checkbox { margin-right: 0.5rem; }
        .controls { 
            margin: 1.5rem 0; 
            display: flex; 
            gap: 0.75rem; 
            flex-wrap: wrap; 
        }
        select, button { 
            padding: 0.5rem 1rem; 
            border: 1px solid #444444; 
            border-radius: 0.375rem; 
            font-size: 0.875rem; 
            background-color: #2A2A2A; 
            color: #FFFFFF; 
        }
        button { 
            background: linear-gradient(45deg, #00C4B4, #1E90FF); 
            cursor: pointer; 
            transition: opacity 0.2s; 
        }
        button:hover { 
            opacity: 0.8; 
        }
        #stopMessage { 
            color: #FF4040; 
            font-weight: 600; 
            text-align: center; 
            margin: 1rem 0; 
            display: none; 
        }
        #screenshotSection { 
            margin-top: 1.5rem; 
        }
        #screenshotSection input[type="file"] { 
            margin-bottom: 0.75rem; 
        }
        #screenshotSection img { 
            max-width: 100%; 
            height: auto; 
            margin: 0.5rem 0; 
            border: 1px solid #333333; 
            border-radius: 0.25rem; 
        }
        #clearScreenshots, #exportData { 
            background: #FF4040; 
            padding: 0.5rem 1rem; 
            border: none; 
            border-radius: 0.375rem; 
            cursor: pointer; 
            transition: opacity 0.2s; 
        }
        #clearScreenshots:hover, #exportData:hover { 
            opacity: 0.8; 
        }
        #summary { 
            margin-top: 1.5rem; 
            padding: 1rem; 
            background-color: #2A2A2A; 
            border-radius: 0.375rem; 
            font-size: 0.875rem; 
        }
        footer { 
            text-align: center; 
            padding: 0.75rem; 
            background: linear-gradient(45deg, #00C4B4, #1E90FF); 
            color: #FFFFFF; 
            font-size: 0.75rem; 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Demon Finder Pro</h1>
    </div>
    <div class="container">
        <div class="controls">
            <select id="demonCount" onchange="saveState()">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
            </select>
            <button onclick="if(confirm('Are you sure you want to reset all data?')) resetForm()">Reset All</button>
        </div>

        <div id="stopMessage">You're gay, stop trading!</div>

        <table id="demonTable">
            <tr>
                <th>DEMON #</th>
                <th>1</th>
                <th>2</th>
                <th>3</th>
                <th>4</th>
                <th>5</th>
                <th>6</th>
                <th>7</th>
                <th>8</th>
                <th>9</th>
                <th>STOP TRADING</th>
            </tr>
            <tr>
                <td>POOR RISK/REWARD TRADE</td>
                <td><input type="checkbox" class="checkbox" data-id="prr-1" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-2" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-3" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-4" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-5" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-6" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-7" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-8" onchange="saveState()"></td>
                <td><input type="checkbox" class="checkbox" data-id="prr-9" onchange="saveState()"></td>
                <td rowspan="9"><input type="checkbox" class="checkbox" data-id="stop" onchange="showStopMessage()"></td>
            </tr>
            <tr><td>ENTERED TOO SOON</td><td><input type="checkbox" class="checkbox" data-id="ets-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="ets-9" onchange="saveState()"></td></tr>
            <tr><td>ENTERED TOO LATE</td><td><input type="checkbox" class="checkbox" data-id="etl-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="etl-9" onchange="saveState()"></td></tr>
            <tr><td>EXITED TOO SOON</td><td><input type="checkbox" class="checkbox" data-id="xso-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xso-9" onchange="saveState()"></td></tr>
            <tr><td>EXITED TOO LATE</td><td><input type="checkbox" class="checkbox" data-id="xla-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="xla-9" onchange="saveState()"></td></tr>
            <tr><td>TRADE NOT IN TRADING PLAN</td><td><input type="checkbox" class="checkbox" data-id="tnp-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="tnp-9" onchange="saveState()"></td></tr>
            <tr><td>INCORRECT STOP PLACEMENT</td><td><input type="checkbox" class="checkbox" data-id="isp-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="isp-9" onchange="saveState()"></td></tr>
            <tr><td>WRONG POSITION SIZE</td><td><input type="checkbox" class="checkbox" data-id="wps-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="wps-9" onchange="saveState()"></td></tr>
            <tr><td>DIDN'T TAKE PLANNED TRADE</td><td><input type="checkbox" class="checkbox" data-id="dtp-1" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-2" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-3" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-4" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-5" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-6" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-7" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-8" onchange="saveState()"></td><td><input type="checkbox" class="checkbox" data-id="dtp-9" onchange="saveState()"></td></tr>
        </table>

        <div id="screenshotSection">
            <input type="file" id="screenshotUpload" accept="image/*" onchange="handleScreenshotUpload(event)" multiple>
            <button id="clearScreenshots" onclick="clearScreenshots()">Clear Screenshots</button>
            <button id="exportData" onclick="exportData()">Export Data</button>
            <div id="screenshotContainer"></div>
        </div>

        <div id="summary">
            <h3>Summary</h3>
            <p id="mostFrequentDemon">Most Frequent Demon: Calculating...</p>
        </div>

        <div class="rules">
            <h2>DEMONS WILL DESTROY YOUR EDGE</h2>
            <p>LEARN FROM YOUR ERRORS. IT IS THE ONLY WAY TO ACHIEVE SUCCESS</p>
            <p>YOUR FUTURE PROFITABILITY DEPENDS ON YOUR KILLING THE DEMONS!</p>
            <h3>RULES:</h3>
            <ol>
                <li>Place a check-mark in the corresponding box each time you commit the error.</li>
                <li>Determine which Demon is outpacing the rest and kill that Demon as quickly as possible.</li>
                <li>Once you have killed the worst Demon then move onto the next.</li>
                <li>If you suffer the same Demon 10 times in a row, you may have some serious psychological issues that are blocking your progress. You should seriously consider whether trading is appropriate for you.</li>
            </ol>
        </div>
    </div>
    <footer>
        <p>Â© 2025 Demon Finder Pro - All Rights Reserved</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', loadState);

        function saveState() {
            const checkboxes = document.querySelectorAll('.checkbox');
            const state = {};
            checkboxes.forEach(cb => {
                state[cb.getAttribute('data-id')] = cb.checked;
            });
            localStorage.setItem('demonFinderState', JSON.stringify(state));
            saveScreenshots();
            updateSummary();
            updateCount();
        }

        function loadState() {
            const savedState = localStorage.getItem('demonFinderState');
            if (savedState) {
                const state = JSON.parse(savedState);
                const checkboxes = document.querySelectorAll('.checkbox');
                checkboxes.forEach(cb => {
                    const id = cb.getAttribute('data-id');
                    if (state[id] !== undefined) {
                        cb.checked = state[id];
                    }
                });
            }
            loadScreenshots();
            updateCount();
            checkStopMessage();
            updateSummary();
        }

        function updateCount() {
            const checkboxes = document.querySelectorAll('.checkbox');
            let count = 0;
            checkboxes.forEach(cb => { if (cb.checked) count++; });
            document.querySelector('.header').style.background = count > 5 ? '#FF4040' : 'linear-gradient(45deg, #00C4B4, #1E90FF)';
        }

        function resetForm() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                document.querySelectorAll('.checkbox').forEach(cb => cb.checked = false);
                localStorage.removeItem('demonFinderState');
                document.getElementById('demonCount').value = '1';
                document.querySelector('.header').style.background = 'linear-gradient(45deg, #00C4B4, #1E90FF)';
                document.getElementById('stopMessage').style.display = 'none';
                localStorage.removeItem('demonFinderScreenshots');
                document.getElementById('screenshotContainer').innerHTML = '';
                updateSummary();
            }
        }

        function showStopMessage() {
            const stopCheckbox = document.querySelector('[data-id="stop"]');
            document.getElementById('stopMessage').style.display = stopCheckbox.checked ? 'block' : 'none';
            saveState();
        }

        function checkStopMessage() {
            const stopCheckbox = document.querySelector('[data-id="stop"]');
            document.getElementById('stopMessage').style.display = stopCheckbox.checked ? 'block' : 'none';
        }

        function handleScreenshotUpload(event) {
            const files = event.target.files;
            if (files.length > 5) {
                alert('Please upload no more than 5 screenshots at a time.');
                return;
            }
            const screenshots = [];
            const readers = [];
            for (let file of files) {
                const reader = new FileReader();
                readers.push(reader);
                reader.onload = function(e) {
                    if (e.target.error) {
                        console.error('Error reading file:', e.target.error);
                        return;
                    }
                    screenshots.push({ src: e.target.result, timestamp: new Date().toISOString() });
                    if (readers.every(r => r.readyState === 2)) {
                        saveScreenshots(screenshots);
                        displayScreenshots(screenshots);
                    }
                };
                reader.onerror = function(e) {
                    console.error('FileReader error:', e);
                };
                reader.readAsDataURL(file);
            }
        }

        function saveScreenshots(screenshots = null) {
            if (screenshots) {
                const existingScreenshots = JSON.parse(localStorage.getItem('demonFinderScreenshots') || '[]');
                const updatedScreenshots = [...existingScreenshots, ...screenshots];
                localStorage.setItem('demonFinderScreenshots', JSON.stringify(updatedScreenshots));
            } else {
                const currentScreenshots = Array.from(document.querySelectorAll('#screenshotContainer img')).map(img => {
                    return { src: img.src, timestamp: img.getAttribute('data-timestamp') };
                });
                localStorage.setItem('demonFinderScreenshots', JSON.stringify(currentScreenshots));
            }
        }

        function loadScreenshots() {
            const savedScreenshots = localStorage.getItem('demonFinderScreenshots');
            if (savedScreenshots) {
                try {
                    const screenshots = JSON.parse(savedScreenshots);
                    displayScreenshots(screenshots);
                } catch (e) {
                    console.error('Error parsing screenshots from localStorage:', e);
                    localStorage.removeItem('demonFinderScreenshots'); // Clear corrupted data
                }
            }
        }

        function displayScreenshots(screenshots) {
            const container = document.getElementById('screenshotContainer');
            container.innerHTML = ''; // Clear existing images
            screenshots.forEach(screenshot => {
                const img = document.createElement('img');
                img.src = screenshot.src;
                img.setAttribute('data-timestamp', screenshot.timestamp);
                img.onload = function() {
                    console.log('Image loaded:', screenshot.src);
                };
                img.onerror = function() {
                    console.error('Failed to load image:', screenshot.src);
                };
                const timestamp = document.createElement('small');
                timestamp.textContent = `Uploaded: ${new Date(screenshot.timestamp).toLocaleString()}`;
                const div = document.createElement('div');
                div.appendChild(img);
                div.appendChild(timestamp);
                container.appendChild(div);
            });
        }

        function clearScreenshots() {
            localStorage.removeItem('demonFinderScreenshots');
            document.getElementById('screenshotContainer').innerHTML = '';
        }

        function updateSummary() {
            const checkboxes = document.querySelectorAll('.checkbox');
            const counts = {
                'prr': 0, 'ets': 0, 'etl': 0, 'xso': 0, 'xla': 0,
                'tnp': 0, 'isp': 0, 'wps': 0, 'dtp': 0
            };
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    const demon = cb.getAttribute('data-id').substring(0, 3);
                    counts[demon]++;
                }
            });
            const maxDemon = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
            document.getElementById('mostFrequentDemon').textContent = `Most Frequent Demon: ${getDemonName(maxDemon)} (${counts[maxDemon]} occurrences)`;
        }

        function getDemonName(code) {
            const demons = {
                'prr': 'Poor Risk/Reward Trade',
                'ets': 'Entered Too Soon',
                'etl': 'Entered Too Late',
                'xso': 'Exited Too Soon',
                'xla': 'Exited Too Late',
                'tnp': 'Trade Not in Plan',
                'isp': 'Incorrect Stop Placement',
                'wps': 'Wrong Position Size',
                'dtp': 'Didn\'t Take Planned Trade'
            };
            return demons[code] || 'None';
        }

        function exportData() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const element = document.getElementById('screenshotSection');
            html2canvas(element).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgProps = doc.getImageProperties(imgData);
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                doc.save(`demon_finder_data_${new Date().toISOString().split('T')[0]}.pdf`);
            });
        }
    </script>
</body>
</html>
